<!DOCTYPE html>
<html class="light" lang="en">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Add Record</title>
  
  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />
  <link href="https://fonts.googleapis.com" rel="preconnect"/>
  <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  
  <!-- Configuration -->
  <script id="tailwind-config">
    tailwind.config = {
      darkMode: "class", 
      theme: {
        extend: {
          colors: {
            primary: "#FAC638", 
            "primary-dark": "#e5b020", 
            "background-light": "#FFFCF5", 
            "background-dark": "#231e0f", 
            "text-main": "#4a3b2a", 
            "text-sub": "#8c805f", 
            "card-bg": "#FFFEF9", 
            "card-warm": "#FFFCF5", 
            success: "#88c458", 
            danger: "#ff8fa3"
          }, 
          fontFamily: {
            display: "Plus Jakarta Sans"
          }, 
          borderRadius: {
            DEFAULT: "0.5rem", 
            lg: "1rem", 
            xl: "1.5rem", 
            "2xl": "2rem",
            full: "9999px"
          }, 
          boxShadow: {
            soft: "0 8px 30px -4px rgba(250, 198, 56, 0.15)", 
            card: "0 4px 14px rgba(74, 59, 42, 0.03)",
          }
        }
      }
    };
  </script>
  
  <style>
    html, body { height: 100%; overflow: hidden; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .mode-active { transform: scale(1.02); box-shadow: 0 4px 12px rgba(0,0,0,0.05); font-weight: 800; }
    
    /* Custom Select Styling */
    .custom-select-wrapper { position: relative; }
    .custom-select-trigger { cursor: pointer; }
    .custom-options { 
      position: absolute; top: 100%; left: 0; right: 0; 
      background: #FFFEF9; border-radius: 1rem; 
      box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1); 
      z-index: 50; padding: 0.5rem; 
      display: none; margin-top: 0.5rem;
      border: 1px solid rgba(0,0,0,0.05);
      max-height: 240px; overflow-y: auto;
    }
    .custom-options.open { display: block; animation: fadeIn 0.2s ease-out; }
    .custom-option { 
      padding: 0.75rem 1rem; border-radius: 0.75rem; 
      display: flex; align-items: center; gap: 0.75rem;
      transition: all 0.1s; cursor: pointer;
    }
    .custom-option:hover { background: #F2EFE5; }
    
    @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
  </style>

  <!-- Components -->
  <script src="components/app-header.js"></script>
  <script src="components/confirm-modal.js"></script>
</head>

<body class="bg-background-light dark:bg-background-dark font-display antialiased text-text-main overflow-x-hidden selection:bg-primary/30">

  <!-- Mobile Container -->
  <div class="relative flex h-full min-h-screen w-full flex-col max-w-md mx-auto bg-background-light dark:bg-background-dark shadow-2xl overflow-hidden border-x border-black/5">
    
    <!-- Header -->
    <app-header type="back" title="Add Record" back-url="points-history.html" hide-more></app-header>

    <main class="flex-1 px-6 pb-32 overflow-y-auto no-scrollbar">
      
      <!-- 1. Child Info -->
      <div class="mt-2 mb-8 flex flex-col items-center">
         <div class="relative mb-3">
            <div class="size-20 rounded-full bg-blue-50 ring-4 ring-white shadow-soft overflow-hidden">
               <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Lucas&backgroundColor=b6e3f4" class="w-full h-full object-cover">
            </div>
            <div class="absolute -bottom-1 -right-1 bg-blue-100 text-blue-600 size-7 flex items-center justify-center rounded-full ring-2 ring-white shadow-sm">
               <span class="material-symbols-rounded text-sm">male</span>
            </div>
         </div>
         <h2 class="text-xl font-extrabold text-text-main">Lucas</h2>
         <p class="text-xs font-bold text-text-sub opacity-60">6 Years Old</p>
      </div>

      <!-- Form Container -->
      <div class="flex flex-col gap-6">
         
         <!-- 2. Record Type (Tabs) -->
         <div class="bg-[#F2EFE5] p-1.5 rounded-2xl ring-1 ring-black/5 flex">
            <button onclick="switchMode('reward')" id="btn-reward" class="mode-active flex-1 py-3 rounded-xl bg-white text-success shadow-sm text-sm transition-all flex items-center justify-center gap-2">
               <span class="material-symbols-rounded">add_circle</span> Reward
            </button>
            <button onclick="switchMode('punish')" id="btn-punish" class="flex-1 py-3 rounded-xl text-text-sub/60 hover:text-text-main text-sm font-bold transition-all flex items-center justify-center gap-2">
               <span class="material-symbols-rounded">remove_circle</span> Punish
            </button>
         </div>

         <!-- 3. Rule Selection (Custom Dropdown) -->
         <div>
            <label class="px-1 text-xs font-bold text-text-sub uppercase tracking-wider mb-2 block">Select Rule</label>
            
            <div class="custom-select-wrapper">
               <!-- Trigger -->
               <div class="custom-select-trigger bg-card-bg p-3 rounded-2xl ring-1 ring-black/5 shadow-card flex items-center gap-3" onclick="toggleDropdown()">
                  <div id="selected-icon-bg" class="size-10 rounded-xl bg-input-bg flex items-center justify-center text-text-sub shrink-0 shadow-inner transition-colors">
                     <span id="selected-icon" class="material-symbols-rounded text-xl">category</span>
                  </div>
                  <span id="selected-text" class="flex-1 text-base font-bold text-text-main">Choose a rule...</span>
                  <span class="material-symbols-rounded text-text-sub">expand_more</span>
               </div>

               <!-- Options (Populated by JS) -->
               <div id="rule-options" class="custom-options no-scrollbar">
                  <!-- Options will be injected here -->
               </div>
            </div>
         </div>

         <!-- 4. Points Input -->
         <div>
            <label class="px-1 text-xs font-bold text-text-sub uppercase tracking-wider mb-2 block">Points</label>
            <div class="bg-card-bg p-2 rounded-2xl ring-1 ring-black/5 focus-within:ring-2 focus-within:ring-primary/50 transition-all shadow-card flex items-center gap-3">
               <div class="size-10 rounded-xl bg-input-bg flex items-center justify-center text-text-sub shrink-0">
                  <span class="material-symbols-rounded text-xl">star</span>
               </div>
               <input type="number" id="points-input" placeholder="0" class="flex-1 bg-transparent border-none p-2 text-xl font-extrabold text-text-main placeholder-text-sub/30 focus:ring-0">
            </div>
         </div>

         <!-- 5. Note Input -->
         <div>
            <label class="px-1 text-xs font-bold text-text-sub uppercase tracking-wider mb-2 block">Note <span class="opacity-50 text-[10px] normal-case tracking-normal">(Optional)</span></label>
            <div class="bg-card-bg p-2 rounded-2xl ring-1 ring-black/5 focus-within:ring-2 focus-within:ring-primary/50 transition-all shadow-card flex items-start gap-3">
               <div class="size-10 rounded-xl bg-input-bg flex items-center justify-center text-text-sub shrink-0 mt-0.5">
                  <span class="material-symbols-rounded text-xl">edit_note</span>
               </div>
               <textarea rows="2" placeholder="Add details..." class="flex-1 bg-transparent border-none p-2 text-sm font-bold text-text-main placeholder-text-sub/30 focus:ring-0 resize-none"></textarea>
            </div>
         </div>

      </div>

    </main>
    
    <!-- Bottom Button -->
    <div class="absolute bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-background-light via-background-light to-transparent pt-12">
        <button onclick="document.querySelector('app-confirm-modal').show({ title: 'Add Record?', message: 'Confirm adding points for this action?', confirmText: 'Confirm', onConfirm: () => window.location.href='points-history.html' })" class="w-full bg-primary hover:bg-primary-dark text-white font-bold text-lg py-4 rounded-2xl shadow-soft flex items-center justify-center gap-2 transition-transform active:scale-95 ring-1 ring-black/5">
            <span class="material-symbols-rounded text-2xl">check</span>
            Confirm
        </button>
    </div>

    <app-confirm-modal></app-confirm-modal>

  </div>

  <script>
    // Data
    const rules = {
      reward: [
        { name: 'Homework', icon: 'menu_book', points: 15, color: 'text-blue-500', bg: 'bg-blue-50' },
        { name: 'Tidy Room', icon: 'cleaning_services', points: 10, color: 'text-green-500', bg: 'bg-green-50' },
        { name: 'Helping', icon: 'volunteer_activism', points: 10, color: 'text-yellow-600', bg: 'bg-yellow-50' },
        { name: 'Reading', icon: 'auto_stories', points: 5, color: 'text-purple-500', bg: 'bg-purple-50' }
      ],
      punish: [
        { name: 'Fighting', icon: 'sentiment_dissatisfied', points: 20, color: 'text-red-500', bg: 'bg-red-50' },
        { name: 'Tantrum', icon: 'warning', points: 10, color: 'text-orange-500', bg: 'bg-orange-50' },
        { name: 'Rude', icon: 'record_voice_over', points: 10, color: 'text-gray-600', bg: 'bg-gray-100' }
      ]
    };

    let currentMode = 'reward';

    function init() {
      renderOptions();
    }

    function switchMode(mode) {
      currentMode = mode;
      const btnReward = document.getElementById('btn-reward');
      const btnPunish = document.getElementById('btn-punish');

      if (mode === 'reward') {
        btnReward.classList.add('mode-active', 'bg-white', 'text-success', 'shadow-sm');
        btnReward.classList.remove('text-text-sub/60');
        
        btnPunish.classList.remove('mode-active', 'bg-white', 'text-danger', 'shadow-sm');
        btnPunish.classList.add('text-text-sub/60');
      } else {
        btnPunish.classList.add('mode-active', 'bg-white', 'text-danger', 'shadow-sm');
        btnPunish.classList.remove('text-text-sub/60');
        
        btnReward.classList.remove('mode-active', 'bg-white', 'text-success', 'shadow-sm');
        btnReward.classList.add('text-text-sub/60');
      }
      
      resetSelection();
      renderOptions();
    }

    function renderOptions() {
      const container = document.getElementById('rule-options');
      container.innerHTML = '';
      
      rules[currentMode].forEach(rule => {
        const div = document.createElement('div');
        div.className = 'custom-option';
        div.onclick = () => selectRule(rule);
        div.innerHTML = `
           <div class="size-8 rounded-lg ${rule.bg} ${rule.color} flex items-center justify-center">
              <span class="material-symbols-rounded text-lg">${rule.icon}</span>
           </div>
           <span class="font-bold text-text-main flex-1">${rule.name}</span>
           <span class="font-extrabold text-xs ${currentMode === 'reward' ? 'text-success' : 'text-danger'}">${currentMode === 'reward' ? '+' : '-'}${rule.points}</span>
        `;
        container.appendChild(div);
      });
    }

    function toggleDropdown() {
      document.getElementById('rule-options').classList.toggle('open');
    }

    function selectRule(rule) {
      // Update UI
      document.getElementById('selected-text').textContent = rule.name;
      document.getElementById('selected-icon').textContent = rule.icon;
      
      const iconBg = document.getElementById('selected-icon-bg');
      iconBg.className = `size-10 rounded-xl flex items-center justify-center shrink-0 shadow-inner transition-colors ${rule.bg} ${rule.color}`;
      
      // Update Points
      document.getElementById('points-input').value = rule.points;
      
      // Close dropdown
      document.getElementById('rule-options').classList.remove('open');
    }

    function resetSelection() {
      document.getElementById('selected-text').textContent = 'Choose a rule...';
      document.getElementById('selected-icon').textContent = 'category';
      document.getElementById('selected-icon-bg').className = 'size-10 rounded-xl bg-input-bg flex items-center justify-center text-text-sub shrink-0 shadow-inner';
      document.getElementById('points-input').value = '';
    }

    // Close dropdown on outside click
    document.addEventListener('click', (e) => {
      const wrapper = document.querySelector('.custom-select-wrapper');
      if (!wrapper.contains(e.target)) {
         document.getElementById('rule-options').classList.remove('open');
      }
    });

    // Init
    init();
  </script>
</body>
</html>