# 儿童奖惩APP MVP需求文档

## 一、产品概述

**产品名称**：儿童奖惩（暂定）

**产品定位**：纯本地化的家庭儿童行为积分管理工具

**核心价值**：通过积分奖惩机制，帮助家长培养宝贝良好行为习惯

**技术特点**：
- 纯本地存储，无需注册登录
- 数据存储于设备本地（SQLite）
- 支持数据备份/恢复

---

## 二、核心功能模块

| 模块 | 功能 | 说明 |
|------|------|------|
| **儿童管理** | 添加宝贝 | 创建宝贝档案（姓名、头像、生日） |
| | 编辑宝贝 | 修改宝贝信息 |
| | 删除宝贝 | 删除宝贝及相关记录 |
| **积分规则** | 系统内置规则 | 预设常见奖惩项，不可删除，可启用/禁用 |
| | 自定义规则 | 家长自建规则，可增删改 |
| **积分操作** | 奖励加分 | 选择奖励规则给宝贝加分 |
| | 惩罚扣分 | 选择惩罚规则给宝贝扣分 |
| | 积分记录 | 查看积分变动历史 |
| **奖励兑换** | 奖励管理 | 创建/编辑/删除奖励项目 |
| | 积分兑换 | 用积分兑换奖励 |
| | 兑换记录 | 查看兑换历史 |

---

## 三、数据模型

### 3.1 实体关系图

```
┌─────────────┐       ┌─────────────┐
│    Child    │ 1:N   │ PointRecord │
│   (宝贝)    │───────│ (积分记录)  │
└─────────────┘       └─────────────┘
       │                     │
       │ 1:N                 │ N:1
       ▼                     ▼
┌─────────────┐       ┌─────────────┐
│  Exchange   │       │    Rule     │
│ (兑换记录)  │       │   (规则)    │
└─────────────┘       └─────────────┘
       │
       │ N:1
       ▼
┌─────────────┐
│   Reward    │
│   (奖励)    │
└─────────────┘
```

### 3.2 数据表结构

#### Child（宝贝表）

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INTEGER | 主键，自增 |
| name | TEXT | 宝贝姓名 |
| avatar | TEXT | 头像（本地路径或预设图标） |
| birthday | TEXT | 生日（可选） |
| gender | TEXT | 性别（可选） |
| current_points | INTEGER | 当前积分，默认0 |
| total_earned | INTEGER | 累计获得积分 |
| total_spent | INTEGER | 累计消费积分 |
| created_at | TEXT | 创建时间 |
| updated_at | TEXT | 更新时间 |

#### Rule（规则表）

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INTEGER | 主键，自增 |
| name | TEXT | 规则名称 |
| points | INTEGER | 积分值（正数） |
| type | TEXT | 类型：REWARD(奖励)/PUNISH(惩罚) |
| icon | TEXT | 图标 |
| is_system | INTEGER | 是否系统内置：1是/0否 |
| is_active | INTEGER | 是否启用：1是/0否 |
| sort_order | INTEGER | 排序顺序 |
| created_at | TEXT | 创建时间 |
| updated_at | TEXT | 更新时间 |

#### Reward（奖励表）

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INTEGER | 主键，自增 |
| name | TEXT | 奖励名称 |
| description | TEXT | 描述（可选） |
| points_cost | INTEGER | 所需积分 |
| icon | TEXT | 图标 |
| stock | INTEGER | 库存，-1表示无限 |
| is_active | INTEGER | 是否启用 |
| created_at | TEXT | 创建时间 |
| updated_at | TEXT | 更新时间 |

#### PointRecord（积分记录表）

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INTEGER | 主键，自增 |
| child_id | INTEGER | 宝贝ID |
| rule_id | INTEGER | 规则ID（可选，兑换时为空） |
| type | TEXT | 类型：REWARD/PUNISH/EXCHANGE |
| points | INTEGER | 积分变动（正数加分，负数扣分） |
| balance | INTEGER | 变动后余额 |
| remark | TEXT | 备注 |
| created_at | TEXT | 创建时间 |

#### ExchangeRecord（兑换记录表）

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INTEGER | 主键，自增 |
| child_id | INTEGER | 宝贝ID |
| reward_id | INTEGER | 奖励ID |
| reward_name | TEXT | 奖励名称（冗余，防止奖励删除后丢失） |
| points_cost | INTEGER | 消耗积分 |
| created_at | TEXT | 创建时间 |

---

## 四、系统内置规则

### 4.1 奖励规则（加分）

| 规则名称 | 默认积分 | 图标 |
|----------|----------|------|
| 按时完成作业 | +10 | 📚 |
| 主动做家务 | +15 | 🧹 |
| 考试进步 | +20 | 📈 |
| 帮助他人 | +10 | 🤝 |
| 按时起床 | +5 | ⏰ |
| 认真阅读 | +10 | 📖 |
| 运动锻炼 | +10 | 🏃 |
| 礼貌待人 | +5 | 🙏 |
| 整理房间 | +10 | 🛏️ |
| 节约粮食 | +5 | 🍚 |

### 4.2 惩罚规则（扣分）

| 规则名称 | 默认积分 | 图标 |
|----------|----------|------|
| 说谎 | -20 | 🤥 |
| 打人 | -30 | 👊 |
| 不按时睡觉 | -5 | 😴 |
| 乱发脾气 | -10 | 😤 |
| 不完成作业 | -15 | ❌ |
| 浪费食物 | -10 | 🗑️ |
| 沉迷游戏 | -10 | 🎮 |
| 顶撞长辈 | -15 | 😠 |
| 乱扔垃圾 | -5 | 🚮 |
| 拖延磨蹭 | -5 | 🐢 |

---

## 五、业务流程

### 5.1 积分奖惩流程

```
┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐
│ 选择宝贝  │ → │ 选择类型  │ → │ 选择规则  │ → │ 确认操作  │
│          │    │(奖励/惩罚)│    │          │    │          │
└──────────┘    └──────────┘    └──────────┘    └──────────┘
                                                      │
                                                      ▼
                                               ┌──────────┐
                                               │ 更新积分  │
                                               │ 记录流水  │
                                               └──────────┘
```

### 5.2 积分兑换流程

```
┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐
│ 选择宝贝  │ → │ 浏览奖励  │ → │ 选择奖励  │ → │ 确认兑换  │
│          │    │  商城    │    │          │    │          │
└──────────┘    └──────────┘    └──────────┘    └──────────┘
                                                      │
                                    ┌─────────────────┤
                                    ▼                 ▼
                              ┌──────────┐     ┌──────────┐
                              │ 积分不足  │     │ 扣除积分  │
                              │ 提示失败  │     │ 记录兑换  │
                              └──────────┘     └──────────┘
```

---

## 六、页面结构

### 6.1 页面层级

```
├── 首页（宝贝列表）
│   ├── 宝贝卡片（头像、姓名、当前积分）
│   ├── [+] 添加宝贝
│   └── 点击进入 → 宝贝详情页
│
├── 宝贝详情页
│   ├── 基本信息区（头像、姓名、积分余额）
│   ├── 快捷操作区
│   │   ├── [奖励] → 奖励规则选择页
│   │   ├── [惩罚] → 惩罚规则选择页
│   │   └── [兑换] → 奖励商城页
│   └── 积分记录区（时间线展示）
│
├── 规则选择页
│   ├── 规则列表（图标、名称、积分）
│   └── 点击规则 → 确认弹窗 → 执行操作
│
├── 规则管理页
│   ├── Tab切换（奖励规则 / 惩罚规则）
│   ├── 系统规则区（启用/禁用开关）
│   ├── 自定义规则区（可增删改）
│   └── [+] 添加自定义规则
│
├── 奖励商城页
│   ├── 当前宝贝积分显示
│   ├── 奖励列表（名称、积分、库存）
│   ├── [+] 添加奖励
│   └── 点击奖励 → 兑换确认
│
├── 奖励管理页
│   ├── 奖励列表
│   └── 奖励增删改操作
│
└── 设置页
    ├── 数据备份
    ├── 数据恢复
    ├── 清空数据
    └── 关于
```

### 6.2 页面清单

| 页面 | 路由 | 功能说明 |
|------|------|----------|
| 首页 | / | 展示所有宝贝列表，快速查看积分 |
| 宝贝详情 | /child/:id | 查看宝贝详情、积分操作入口、历史记录 |
| 添加/编辑宝贝 | /child/form | 宝贝信息表单 |
| 奖励规则选择 | /rules/reward/:childId | 选择奖励规则进行加分 |
| 惩罚规则选择 | /rules/punish/:childId | 选择惩罚规则进行扣分 |
| 规则管理 | /rules/manage | 管理系统规则和自定义规则 |
| 添加/编辑规则 | /rules/form | 规则信息表单 |
| 奖励商城 | /rewards/:childId | 浏览奖励、执行兑换 |
| 奖励管理 | /rewards/manage | 管理奖励项目 |
| 添加/编辑奖励 | /rewards/form | 奖励信息表单 |
| 积分记录 | /records/:childId | 查看完整积分变动历史 |
| 兑换记录 | /exchanges/:childId | 查看兑换历史 |
| 设置 | /settings | 数据备份恢复、关于 |

---

## 七、技术方案

### 7.1 技术选型

| 层面 | 技术 | 说明 |
|------|------|------|
| 框架 | Flutter | 跨平台，一套代码支持iOS/Android |
| 数据库 | SQLite | 本地存储，使用sqflite插件 |
| 状态管理 | Provider/Riverpod | 轻量级状态管理 |
| 本地存储 | shared_preferences | 存储配置项 |

### 7.2 项目结构

```
lib/
├── main.dart                 # 入口
├── models/                   # 数据模型
│   ├── child.dart
│   ├── rule.dart
│   ├── reward.dart
│   ├── point_record.dart
│   └── exchange_record.dart
├── database/                 # 数据库
│   ├── database_helper.dart
│   └── init_data.dart        # 初始化内置数据
├── providers/                # 状态管理
│   ├── child_provider.dart
│   ├── rule_provider.dart
│   └── reward_provider.dart
├── pages/                    # 页面
│   ├── home/
│   ├── child/
│   ├── rules/
│   ├── rewards/
│   └── settings/
├── widgets/                  # 通用组件
└── utils/                    # 工具类
```

---

## 八、MVP开发阶段

### 第一阶段：基础功能
- [ ] 项目初始化、数据库搭建
- [ ] 宝贝管理（增删改查）
- [ ] 系统内置规则初始化
- [ ] 积分奖惩操作
- [ ] 积分记录展示

### 第二阶段：规则与兑换
- [ ] 自定义规则管理
- [ ] 奖励项目管理
- [ ] 积分兑换功能
- [ ] 兑换记录展示

### 第三阶段：完善体验
- [ ] 数据备份/恢复
- [ ] UI美化优化
- [ ] 数据统计图表

---

## 九、扩展功能（后续版本）

| 功能 | 说明 |
|------|------|
| 任务系统 | 创建每日/每周任务，完成自动加分 |
| 成就徽章 | 累计达成目标获得徽章 |
| 数据统计 | 周/月积分趋势图表 |
| 多设备同步 | 云端备份，多设备数据同步 |
| 家庭共享 | 多家长共同管理 |
